<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Product Catalog</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Hide scrollbar for category filters */
        #filters::-webkit-scrollbar { display: none; }
        #filters { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Smooth image loading */
        .product-img { transition: opacity 0.3s ease; }
        .product-img[src=""] { opacity: 0; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-10">

    <header class="bg-white shadow-sm sticky top-0 z-10 px-4 py-4">
        <h1 class="text-xl font-bold text-gray-800">Product Catalog</h1>
        
        <div id="filters" class="flex gap-2 mt-3 overflow-x-auto whitespace-nowrap">
            </div>
    </header>

    <main id="product-grid" class="p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="text-center py-20 text-gray-500 col-span-full">Loading products...</div>
    </main>

    <script>
        // 1. CONFIGURATION: Replace with your "Published as CSV" Google Sheet link
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRrOvPSFcYPYu3oykN0YKQ0QNsiv8DudaPZAmtFT5biDihKfV8uGmoRsSFsfX5t6GoPYn6K-D2JDGAw/pub?output=csv';

        let allProducts = [];

        // 2. DATA FETCHING
        async function loadData() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                const csvText = await response.text();
                
                // Parse CSV accurately (handling quotes/commas)
                allProducts = parseCSV(csvText);
                
                renderFilters(allProducts);
                renderProducts(allProducts);

            } catch (error) {
                document.getElementById('product-grid').innerHTML = 
                    `<div class="text-red-500 text-center col-span-full">Error loading data. Check internet or CSV link.</div>`;
            }
        }

        // 3. CSV PARSER (Handles quoted text and commas inside cells)
        function parseCSV(text) {
            const lines = text.split(/\r?\n/);
            const result = [];
            const headers = lines[0].split(',');

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i]) continue;
                // Regex to handle commas inside quotes
                const values = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                if (values) {
                    result.push({
                        category: values[0].replace(/"/g, ''),
                        name: values[1].replace(/"/g, ''),
                        price: values[2].replace(/"/g, ''),
                        offer: values[3].replace(/"/g, ''),
                        image: values[4].replace(/"/g, '')
                    });
                }
            }
            return result;
        }

        // 4. RENDER CATEGORY BUTTONS
        function renderFilters(products) {
            const categories = ['All', ...new Set(products.map(p => p.category))];
            const filterContainer = document.getElementById('filters');
            
            filterContainer.innerHTML = categories.map(cat => `
                <button onclick="filterProducts('${cat}', this)" 
                    class="filter-btn px-5 py-2 rounded-full border bg-white text-sm font-medium transition-colors
                    ${cat === 'All' ? 'bg-blue-600 text-white border-blue-600' : 'text-gray-600 border-gray-300'}">
                    ${cat}
                </button>
            `).join('');
        }

        // 5. RENDER PRODUCT CARDS
        function renderProducts(products) {
            const grid = document.getElementById('product-grid');
            if (products.length === 0) {
                grid.innerHTML = `<div class="text-center col-span-full py-10">No products found.</div>`;
                return;
            }

            grid.innerHTML = products.map(item => `
                <div class="bg-white rounded-2xl overflow-hidden shadow-md border border-gray-200 flex flex-col">
                    <img src="${item.image}" alt="${item.name}" class="product-img w-full h-56 object-cover bg-gray-200">
                    <div class="p-4 flex-grow">
                        <span class="text-[10px] font-bold tracking-widest text-blue-600 uppercase">${item.category}</span>
                        <h2 class="text-lg font-bold text-gray-900 mt-1">${item.name}</h2>
                        <p class="text-2xl font-black text-gray-800 mt-2">${item.price}</p>
                        
                        ${item.offer ? `
                            <div class="mt-3 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
                                <p class="text-xs font-bold text-yellow-800 uppercase tracking-tight">Special Offer</p>
                                <p class="text-sm text-yellow-900 font-medium">${item.offer}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // 6. FILTER LOGIC
        function filterProducts(category, btn) {
            // UI Update
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                b.classList.add('bg-white', 'text-gray-600', 'border-gray-300');
            });
            btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');

            // Data Update
            if (category === 'All') {
                renderProducts(allProducts);
            } else {
                const filtered = allProducts.filter(p => p.category === category);
                renderProducts(filtered);
            }
        }

        // Start App
        loadData();
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(() => {
                    console.log('SW registration failed (not needed for basic use)');
                });
            });
        }
    </script>
</body>
</html>